{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.collectSources = void 0;\nconst path = __importStar(require(\"path\"));\n/**\n * Collects sources, targets into collections with OS-independent paths,\n * along with a reverse mapping to the original path (for post-processing)\n *\n * @param originalSources - { [originalSourcePath]: contents }\n * @param originalTargets - originalSourcePath[]\n * @param baseDirectory - a directory to remove as a prefix\n * @param replacement - what to replace it with\n * @return { sources, targets, originalSourcePaths }\n */\nfunction collectSources(originalSources) {\n  let originalTargets = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  let baseDirectory = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : \"\";\n  let replacement = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : \"/\";\n  const mappedResults = Object.entries(originalSources).filter(_ref => {\n    let [originalSourcePath, _] = _ref;\n    return !path.isAbsolute(originalSourcePath) || originalSourcePath.startsWith(baseDirectory);\n  }).map(_ref2 => {\n    let [originalSourcePath, contents] = _ref2;\n    return {\n      originalSourcePath,\n      contents,\n      sourcePath: getPortableSourcePath(replaceRootDirectory(originalSourcePath, baseDirectory, replacement))\n    };\n  }).map(_ref3 => {\n    let {\n      originalSourcePath,\n      sourcePath,\n      contents\n    } = _ref3;\n    return {\n      sources: {\n        [sourcePath]: contents\n      },\n      // include transformed form as target if original is a target\n      targets: originalTargets.includes(originalSourcePath) ? [sourcePath] : [],\n      originalSourcePaths: {\n        [sourcePath]: originalSourcePath\n      }\n    };\n  });\n  const defaultAccumulator = {\n    sources: {},\n    targets: [],\n    originalSourcePaths: {}\n  };\n  return mappedResults.reduce((accumulator, result) => ({\n    sources: Object.assign({}, accumulator.sources, result.sources),\n    targets: [...accumulator.targets, ...result.targets],\n    originalSourcePaths: Object.assign({}, accumulator.originalSourcePaths, result.originalSourcePaths)\n  }), defaultAccumulator);\n}\nexports.collectSources = collectSources;\n/**\n * @param sourcePath - string\n * @return string - operating system independent path\n * @private\n */\nfunction getPortableSourcePath(sourcePath) {\n  let replacement = sourcePath;\n  //on Windows, replace backslashes with forward slashes\n  if (path.sep === \"\\\\\") {\n    replacement = sourcePath.replace(/\\\\/g, \"/\");\n  }\n  // Turn G:/.../ into /G/.../ for Windows\n  if (replacement.length >= 2 && replacement[1] === \":\") {\n    replacement = \"/\" + replacement;\n    replacement = replacement.replace(\":\", \"\");\n  }\n  return replacement;\n}\nfunction replaceRootDirectory(sourcePath, rootDirectory, replacement) {\n  //make sure root directory ends in a separator\n  if (!rootDirectory.endsWith(path.sep)) {\n    rootDirectory = rootDirectory + path.sep;\n  }\n  return sourcePath.startsWith(rootDirectory) ? replacement + sourcePath.slice(rootDirectory.length) //remove prefix\n  : sourcePath;\n}","map":{"version":3,"mappings":"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","names":["collectSources","originalSources","originalTargets","baseDirectory","replacement","mappedResults","Object","entries","filter","originalSourcePath","_","path","isAbsolute","startsWith","map","contents","sourcePath","getPortableSourcePath","replaceRootDirectory","sources","targets","includes","originalSourcePaths","defaultAccumulator","reduce","accumulator","result","assign","exports","sep","replace","length","rootDirectory","endsWith","slice"],"sourceRoot":"","sources":["../../src/sources.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}